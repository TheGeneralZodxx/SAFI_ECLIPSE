<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:ace="http://www.icefaces.org/icefaces/components"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">      
    <ui:composition template="./layout.xhtml">
        <ui:define name="content">
            <h:form id="formMovimiento" title=" ">
                <ace:panel id="MovimientoPanelActualizar" header="#{msg.confMovimiento}">
                    <h:panelGrid  columns="2" class="panel-buttons">
                        <h:panelGroup>
                            <span class="fa fa-refresh" aria-hidden="true" style="margin-right: 5px;"/>
                            <ace:linkButton action="movimientoConf" actionListener="#{movimientoManagedBean.actualizar}"  value="#{msg.confMovimiento}"/>                                
                        </h:panelGroup>
                        <h:panelGroup rendered="#{movimientoManagedBean.alta}">
                            <span class="fa fa-plus" aria-hidden="true" style="margin-right: 5px;"/>
                            <ace:linkButton action="nuevoMovimiento" value="#{msg.newMovimiento}" actionListener="#{movimientoManagedBean.limpiar()}" />                          
                        </h:panelGroup>
                    </h:panelGrid>
                    <ace:panel id="movimientoPanelBusqueda" header="#{msg.busqueda}" toggleable="true" toggleSpeed="200" collapsed="false"  >
                        <table border="0" cellspacing="5" class="table-buttons">
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.ejercicio}:" />
                                </td>
                                <td align="left">
                                    <ace:simpleSelectOneMenu id="slcEjercicio" value="#{movimientoManagedBean.idEjercicioBsq}" label="#{msg.ejercicio}">
                                        <f:selectItem  itemValue="0" noSelectionOption="true" itemLabel="#{msg.todos}"/>
                                        <f:selectItems value="#{movimientoManagedBean.selectItemsEjercicioBsq}" />
                                        <ace:ajax execute="@this" render="@this slcEjercicio slcSservicio slcCuentaBancaria" event="valueChange"/>
                                    </ace:simpleSelectOneMenu>
                                </td>                            
                            </tr>
                            <ui:fragment rendered="#{movimientoManagedBean.servicioUsuario}" >
                                <tr>
                                    <td align="right">
                                        <h:outputLabel value="#{msg.servicio}:" />
                                    </td>
                                    <td align="left">
                                        <ace:simpleSelectOneMenu id="slcSservicio" value="#{movimientoManagedBean.idServicioBsq}" label="#{msg.servicio}">
                                            <f:selectItem  itemValue="0" noSelectionOption="true" itemLabel="#{msg.todos}"/>
                                            <f:selectItems value="#{movimientoManagedBean.selectItemsServicioBsq}" /> 
                                            <ace:ajax execute="@this" render="@this slcSservicio slcCuentaBancaria" event="valueChange"/>
                                        </ace:simpleSelectOneMenu>
                                    </td>                            
                                </tr> 
                            </ui:fragment>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.cuentaBancaria}:" />
                                </td>
                                <td align="left">
                                    <ace:simpleSelectOneMenu id="slcCuentaBancaria" value="#{movimientoManagedBean.idCuentaBancariaBsq}" label="#{msg.cuentaBancaria}">
                                        <f:selectItem  itemValue="0" noSelectionOption="true" itemLabel="#{msg.todas}"/>
                                        <f:selectItems value="#{movimientoManagedBean.selectItemsCuentaBancariaBsq}"  />   
                                        <ace:ajax />                                 
                                    </ace:simpleSelectOneMenu>
                                </td>                            
                            </tr>  
                            <tr >


                                <td align="right">
                                    <h:outputLabel value="#{msg.fechaAlta}:" />
                                </td>
                                <td align="left">
                                    <ace:maskedEntry id="fechaAltaDesde" value="#{movimientoManagedBean.fechaAltaDesdeBsq}" label="#{msg.fechaAltaDesde}" title="#{msg.fechaAltaDesde}" 
                                                     style="width: 48% !important;" mask="99/99/9999" >                                    
                                        <f:convertDateTime pattern="dd/MM/yyyy" locale="es_AR" timeZone="America/Argentina/Buenos_Aires"/> 
                                    </ace:maskedEntry>
                                    <span class="separador" > - </span>
                                    <ace:maskedEntry id="fechaAltaHasta" value="#{movimientoManagedBean.fechaAltaHastaBsq}" label="#{msg.fechaAltaHasta}"  title="#{msg.fechaAltaHasta}" 
                                                     style="width: 48% !important;" mask="99/99/9999" >                                    
                                        <f:convertDateTime pattern="dd/MM/yyyy" locale="es_AR" timeZone="America/Argentina/Buenos_Aires"/> 
                                    </ace:maskedEntry>
                                </td>                            
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value=" #{msg.tipoOrden}:" />
                                </td>
                                <td align="left">
                                    <ace:simpleSelectOneMenu id="slcTipoOrdenGasto" label="#{msg.tipoOrden}"
                                                             value="#{movimientoManagedBean.idTipoOrdenGastoBsq}"
                                                             required="false">
                                        <f:selectItem  itemValue="0" noSelectionOption="true" itemLabel="#{msg.elegir}"/>
                                        <f:selectItems value="#{movimientoManagedBean.selectItemsTipoOrdenGastoBsq}" /> 

                                        <ace:ajax render="slcTipoFondo slcTipoImputacion " event="valueChange"/> 
                                    </ace:simpleSelectOneMenu>
                                </td>
                                <td align="left">
                                    <ace:message id="slcTipoOrdenGastoMsg" for="slcTipoOrdenGasto" initEffect="slide" changeEffect="shake"/> 
                                </td>
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value=" #{msg.tipoFondo}:" />
                                </td>
                                <td align="left">
                                    <ace:simpleSelectOneMenu id="slcTipoFondo" label="#{msg.tipoFondo}"
                                                             value="#{movimientoManagedBean.idTipoFondoBsq}"
                                                             required="false">
                                        <f:selectItem  itemValue="0" noSelectionOption="true" itemLabel="#{msg.elegir}"/>
                                        <f:selectItems value="#{movimientoManagedBean.selectItemsTipoFondoBsq}" /> 

                                        <ace:ajax execute="@this" render="slcTipoImputacion" event="valueChange" /> 
                                    </ace:simpleSelectOneMenu>
                                </td>
                                <td align="left">
                                    <ace:message id="slcTipoFondoMsg" for="slcTipoFondo" initEffect="slide" changeEffect="shake"/> 
                                </td>
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value=" #{msg.tipoImputacion}:" />
                                </td>
                                <td align="left">
                                    <ace:simpleSelectOneMenu id="slcTipoImputacion" label="#{msg.tipoImputacion}"
                                                             value="#{movimientoManagedBean.idTipoImputacionBsq}"
                                                             required="false">
                                        <f:selectItem  itemValue="0" noSelectionOption="true" itemLabel="#{msg.elegir}"/>
                                        <f:selectItems value="#{movimientoManagedBean.selectItemsTipoImputacionBsq}"  /> 

                                        <ace:ajax execute="@this"  event="valueChange" /> 
                                    </ace:simpleSelectOneMenu>
                                </td>
                                <td align="left">
                                    <ace:message id="slcTipoImputacionMsg" for="slcTipoImputacion" initEffect="slide" changeEffect="shake"/> 
                                </td>
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.nroOrden}:" />
                                </td>
                                <td align="left">
                                    <ace:textEntry id="nroOrden" label="#{msg.nroOrden}" 
                                                   value="#{movimientoManagedBean.numeroOrdenBsq}"                                                   
                                                   p:onkeydown="#{movimientoManagedBean.soloNumeros}">

                                    </ace:textEntry>
                                </td>
                                <td align="left">
                                    <ace:message id="nroOrdenMsg" for="nroOrden" initEffect="slide" changeEffect="shake"/> 
                                </td>
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.nroPedidoFondo}:" />
                                </td>
                                <td align="left">
                                    <ace:textEntry id="nroPedidoFondo" label="#{msg.nroPedidoFondo}"
                                                   value="#{movimientoManagedBean.numeroPedidoFondoBsq}"                                                   
                                                   p:onkeydown="#{movimientoManagedBean.soloNumeros}">

                                    </ace:textEntry>
                                </td>
                                <td align="left">
                                    <ace:message id="nroPedidoFondoMsg" for="nroPedidoFondo" initEffect="slide" changeEffect="shake"/> 
                                </td>
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.nroEntregaFondo}:" />
                                </td>
                                <td align="left">
                                    <ace:textEntry id="nroEntregaFondo" label="#{msg.nroEntregaFondo}" value="#{movimientoManagedBean.numeroEntregaFondoBsq}"

                                                   p:onkeydown="#{movimientoManagedBean.soloNumeros}">

                                    </ace:textEntry>
                                </td>
                                <td align="left">
                                    <ace:message id="nroEntregaFondoMsg" for="nroEntregaFondo" initEffect="slide" changeEffect="shake"/> 
                                </td>
                            </tr>
                            <tr>
                                <td align="right">
                                    <h3>  <h:outputLabel value="#{msg.sobreExpte}" /></h3>
                                </td>
                                <td align="left">  </td>                            
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.codigoOrganismo}:" />
                                </td>
                                <td align="left">
                                    <ace:textEntry value="#{movimientoManagedBean.codigoBsq}" type="number"
                                                   p:onkeydown="javascript: return event.keyCode==69 ? false: true"/>
                                </td>                            
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.correlativo}:" />
                                </td>
                                <td align="left">
                                    <ace:textEntry value="#{movimientoManagedBean.numeroBsq}" type="number"
                                                   p:onkeydown="javascript: return event.keyCode==69 ? false: true"/>
                                </td>                            
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.anio}:" />
                                </td>
                                <td align="left">
                                    <ace:textEntry id="anioBsq" label="#{msg.anio}"
                                                   value="#{movimientoManagedBean.anioBsq}"
                                                   validator="#{movimientoManagedBean.validarAnioExp}"
                                                   type="number"
                                                   p:onkeydown="javascript: return event.keyCode==69 ? false: true"     
                                                   placeholder="#{msg.ejemplo}" >                                                 
                                        <ace:ajax execute="@this" render="@this anioBsq anioMsg" event="blur"></ace:ajax>                         
                                    </ace:textEntry>
                                </td>   
                                <td align="left">
                                    <ace:message id="anioMsg" for="anioBsq" /> 
                                </td>
                            </tr>  
                            <tr>
                                <td align="right">
                                    <h3><h:outputLabel value="#{msg.sobreComprobante}" /></h3>
                                </td>
                                <td align="left">  </td>                            
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.fechaComprobante}:" />
                                </td>
                                <td align="left">
                                    <ace:maskedEntry id="fechaComprobDesde" value="#{movimientoManagedBean.fechaComprobDesdeBsq}" label="#{msg.fechaComprobDesde}"  title="#{msg.fechaComprobDesde}"
                                                     style="width: 48% !important;" mask="99/99/9999" >                                    
                                        <f:convertDateTime pattern="dd/MM/yyyy" locale="es_AR" timeZone="America/Argentina/Buenos_Aires"/> 
                                    </ace:maskedEntry>
                                    <span class="separador" > - </span>
                                    <ace:maskedEntry id="fechaComrobHasta" value="#{movimientoManagedBean.fechaComprobHastaBsq}"  label="#{msg.fechaComprobHasta}" title="#{msg.fechaComprobHasta}"
                                                     style="width: 48% !important;" mask="99/99/9999" >                                    
                                        <f:convertDateTime pattern="dd/MM/yyyy" locale="es_AR" timeZone="America/Argentina/Buenos_Aires"/> 
                                    </ace:maskedEntry>
                                </td>                            
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.descri}:" />
                                </td>
                                <td align="left">
                                    <ace:textEntry value="#{movimientoManagedBean.descripcionBsq}" />
                                </td>                            
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.importe}:" />
                                </td>
                                <td align="left">
                                    <ace:textEntry value="#{movimientoManagedBean.impDesde}" 
                                                   style="width: 48% !important;"
                                                   placeholder="#{msg.importeDesde}"
                                                   p:onkeydown="#{movimientoManagedBean.soloNumeros}"
                                                   />          
                                    <span class="separador" > - </span>
                                    <ace:textEntry value="#{movimientoManagedBean.impHasta}" 
                                                   style="width:48% !important;"
                                                   placeholder="#{msg.importeHasta}"
                                                   p:onkeydown="#{movimientoManagedBean.soloNumeros}"/>
                                </td>                            
                            </tr>
                        </table>    
                        <div align="right" >
                            <h:panelGrid columns="2" >
                                <ace:pushButton id="find" value="#{msg.find}" actionListener="#{movimientoManagedBean.aplicarFiltro}"/>
                                <ace:pushButton id="actualizar" value="#{msg.actualizar}" actionListener="#{movimientoManagedBean.actualizar}"/>
                            </h:panelGrid>
                        </div>
                        <ace:submitMonitor id="submitMonitorPage"
                                           for=":formMovimiento:movimientoPanelBusqueda :formMovimiento:MovimientoPanelActualizar "
                                           blockUI="@all"
                                           autoCenter="true"
                                           styleClass="submonitor"
                                           />
                    </ace:panel>
                    <div align="right">
                        <ace:pushButton id="exporter" action="successErrorExportMovimientos" actionListener="#{movimientoManagedBean.prepararReportes()}" > 
                            <i class="fa fa-file-excel-o" aria-hidden="true"></i>
                            #{msg.exportar}
                        </ace:pushButton>
                    </div>
                     <ace:dataTable id="movimientoDataTable" value="#{movimientoManagedBean.listElements}" var="item"
                                   page="#{movimientoManagedBean.page}" 
                                   lazy="true"
                                   rows="10"
                                   paginator="true"
                                   paginatorAlwaysVisible="true"
                                   paginatorPosition="bottom"
                                   paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                                   currentPageReportTemplate="#{msg.pageReportTemplate}"
                                   rowIndexVar="row">
                        <ace:tableConfigPanel id="tableConfig"
                                              dragHandle=".ui-tableconf-header"
                                              columnNameConfigurable="false"
                                              columnVisibilityConfigurable="true"
                                              columnOrderingConfigurable="false"
                                              columnSortingConfigurable="false"
                                              modal="true"
                                              type="last-col">
                        </ace:tableConfigPanel>
                        
                        <ace:column id="nroAsiento" headerText="#{msg.nroAsiento}" >
                            <center>
                                <h:outputText id="cellnroAsiento" value="#{item.numeroAsiento}"/>
                            </center>                            
                        </ace:column>
                        
                        <ace:column id="nroCuenta" headerText="#{msg.numeroCuenta}">
                            <center>
                                <h:outputText id="cellnroCuenta" value="#{item.cuentaBancaria.numero}"/>
                            </center>                            
                        </ace:column>
                        <ace:column id="fechaAlta" headerText="#{msg.fechaAlta}">
                            <center>
                                <h:outputText id="cellFechaAlta" value="#{item.fechaAlta}">
                                    <f:convertDateTime pattern="dd/MM/yyyy" locale="es_AR" timeZone="America/Argentina/Buenos_Aires"/> 
                                </h:outputText>
                            </center>                            
                        </ace:column>
                        <ace:column id="servicio" headerText="#{msg.servicio}">
                            <div class="panel-column-data-left">
                                <h:outputText id="cellServicio" value="#{item.cuentaBancaria.servicio.codigo} - #{item.cuentaBancaria.servicio.abreviatura}"/>
                            </div>                            
                        </ace:column>
                        <ace:column id="Operacion" headerText="#{msg.operacion}">
                            <center>
                                <h:outputText id="celltipoOrdenGasto" value="#{empty item.funciones?'-':item.funciones.get(0).tipoOrdenGasto.id} 
                                              - #{empty item.funciones?'-':item.funciones.get(0).tipoFondo.id} 
                                              - #{empty item.funciones?'-':item.funciones.get(0).tipoImputacion.id}"/>                               
                            </center>                            
                        </ace:column>
                        <ace:column id="importeT" headerText="#{msg.importe}">
                            <center>
                                <h:outputText id="cellImporteT" value="#{item.importe}" >
                                    <f:convertNumber currencySymbol="$" groupingUsed="true" locale="es_AR" type="currency"/>
                                </h:outputText>
                            </center>                            
                        </ace:column>
                       
                       
                        <ace:column id="descripcion" headerText="#{msg.descri}">
                            <div class="panel-column-data-left">
                                <h:outputText id="cellDescripcion" value="#{item.descripcion}"/>
                            </div>                            
                        </ace:column>
                        <ace:column id="Nroexpediente" headerText="#{msg.expedienteM}">
                            <center>                           
                                <h:outputText id="cellNroexpediente" value="#{item.expediente.codigo}-#{item.expediente.numero}/#{item.expediente.anio}"/>                           
                            </center>
                        </ace:column>
                        <ace:column id="Nrocomprobante" headerText="#{msg.nroComprobanteM}">
                            <center>                           
                                <h:outputText id="cellNrocomprobante" value="#{item.numeroComprobante}"/>                          
                            </center>
                        </ace:column>
                        <ace:column id="accion" headerText="#{msg.action}" class="panelAcciones" >
                            <h:panelGrid  columns="2"> 
                                <ace:pushButton id="detalle"  action="detalleMovimiento" p:title="#{msg.detalle}" actionListener="#{movimientoManagedBean.verDetalle}" rendered="#{movimientoManagedBean.detalle}">
                                    <span class="fa fa-search-plus" aria-hidden="true" />    
                                    <f:param name="id" value="#{item.id}"/>
                                </ace:pushButton>
                                <ace:pushButton id="revertir"  action="revertirMovimiento" p:title="Revertir Movimiento" actionListener="#{movimientoManagedBean.prepararParaRevertir()}" rendered="#{movimientoManagedBean.revertirMovimiento}" disabled="#{not movimientoManagedBean.canBeReversed(item)}">
                                    <span class="fa fa-reply" aria-hidden="true" />  
                                    <f:param name="id" value="#{item.id}"/>
                                </ace:pushButton> 
                            </h:panelGrid>
                        </ace:column>                         
                    </ace:dataTable> 
                               
                </ace:panel>
            </h:form>
        </ui:define>
    </ui:composition>
</html>
