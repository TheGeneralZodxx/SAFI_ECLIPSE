<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:ace="http://www.icefaces.org/icefaces/components"
      xmlns:f="http://xmlns.jcp.org/jsf/core"> 
    <ui:composition template="./layout.xhtml">  
        <ui:define name="content">
            <h:form id="formAuditoria" title=" " styleClass="form">
                <ace:panel id="logPanelPrincipal" header="#{msg.confLog}">
                    <h:panelGrid  columns="2" class="panel-buttons">
                        <h:panelGroup>
                            <span class="fa fa-refresh" aria-hidden="true" style="margin-right: 5px;"></span>
                            <h:commandLink action="logConf" actionListener="#{auditoriaManagedBean.actualizar}" value="#{msg.confLog}"/>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{auditoriaManagedBean.alta}">
                            <span class="fa fa-plus" aria-hidden="true" style="margin-right: 5px;"></span>
                            <h:commandLink action="nuevoLog" value="#{msg.newLog}" actionListener="#{auditoriaManagedBean.limpiar()}"/>
                        </h:panelGroup>
                    </h:panelGrid>
                    <ace:panel id="auditoriaPanelBusqueda" header="#{msg.busqueda}" collapsed="true"  toggleable="true" toggleSpeed="200" class="panel-buttons">
                        <table border="0" cellspacing="5" class="panel-buttons">
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.ejercicio}:" />
                                </td>
                                <td align="left">
                                    <ace:simpleSelectOneMenu id="slcEjercicio" value="#{auditoriaManagedBean.idEjercicioBsq}" label="#{msg.ejercicio}">
                                        <f:selectItem itemValue="0" itemLabel="#{msg.todos}"/>
                                        <f:selectItems value="#{auditoriaManagedBean.selectItemsEjercicio}" />
                                        <ace:ajax render="@this slcEjercicio slcSservicio" event="valueChange"/>
                                    </ace:simpleSelectOneMenu>
                                </td>                            
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.servicio}:" />
                                </td>
                                <td align="left">
                                    <ace:simpleSelectOneMenu id="slcSservicio" value="#{auditoriaManagedBean.idServicioBsq}" label="#{msg.servicio}">
                                        <f:selectItem itemValue="0" itemLabel="#{msg.todos}"/>
                                        <f:selectItems value="#{auditoriaManagedBean.selectItemsServicio}" /> 
                                        <ace:ajax render="@this slcSservicio usuario" event="valueChange"/>
                                    </ace:simpleSelectOneMenu>
                                </td>                            
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.uss}:" />
                                </td>
                                <td align="left">
                                    <ace:simpleSelectOneMenu id="usuario"
                                                             value="#{auditoriaManagedBean.idUsuarioBsq}">
                                        <f:selectItem itemValue="0" itemLabel="#{msg.todos}"/>
                                        <f:selectItems value="#{auditoriaManagedBean.usuariosDisponibles}" />
                                        <ace:ajax execute="@this" render="@this usuarioError" event="valueChange"/>
                                    </ace:simpleSelectOneMenu>
                                </td>
                                <td align="left">
                                    <ace:message id="usuarioError" for="usuario" initEffect="slide" changeEffect="fade"></ace:message>
                                </td>
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.action}:" />
                                </td>
                                <td align="left">
                                    <ace:simpleSelectOneMenu id="action"
                                                             value="#{auditoriaManagedBean.accionBsq}">
                                        <f:selectItem itemValue="" itemLabel="#{msg.todas}"/>
                                        <f:selectItems value="#{auditoriaManagedBean.selectItemsAcciones}" />
                                        <ace:ajax execute="@this" render="@this action accError" event="valueChange"/>
                                    </ace:simpleSelectOneMenu>
                                </td>
                                <td align="left">
                                    <ace:message id="accError" for="action" initEffect="slide" changeEffect="fade"></ace:message>
                                </td>
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.valor}:" />
                                </td>
                                <td align="left">
                                    <ace:textEntry id="valor" value="#{auditoriaManagedBean.valorBsq}" maxlength="#{msg.maxLength}"/>
                                </td>                             
                            </tr>
                            <tr>
                                <td align="right" class="td-label">
                                    <h:outputLabel value="#{msg.fechaDesde}:" />
                                </td>
                                <td align="left" class="td-input">
                                    <ace:maskedEntry mask="99/99/9999" value="#{auditoriaManagedBean.fechaDesdeBuscar}" id="fechaDesdeBuscar" >
                                        <ace:ajax execute="@this" render="@this fechaDesdeBuscar fechaDesdeBuscarMsg" event="blur"></ace:ajax>
                                        <f:convertDateTime timeZone="America/Argentina/Buenos_Aires" pattern="dd/MM/yyyy" locale="es_AR"></f:convertDateTime>
                                    </ace:maskedEntry>
                                </td>
                                <td align="left">
                                    <ace:message id="fechaDesdeBuscarMsg" for="fechaDesdeBuscar" initEffect="slide" changeEffect="shake"/> 
                                    <ace:ajax />
                                </td>
                            </tr>
                            <tr>
                                <td align="right" class="td-label">
                                    <h:outputLabel value="#{msg.fechaHasta}:" />
                                </td>
                                <td align="left" class="td-input">
                                    <ace:maskedEntry mask="99/99/9999" value="#{auditoriaManagedBean.fechaHastaBuscar}" id="fechaHastaBuscar">
                                        <ace:ajax execute="@this" render="@this fechaHastaBuscar fechaHastaBuscarMsg" event="blur"></ace:ajax>
                                        <f:convertDateTime timeZone="America/Argentina/Buenos_Aires" pattern="dd/MM/yyyy" locale="es_AR"></f:convertDateTime>
                                    </ace:maskedEntry>
                                </td>
                                <td align="left">
                                    <ace:message id="fechaHastaBuscarMsg" for="fechaHastaBuscar" initEffect="slide" changeEffect="shake"/> 
                                    <ace:ajax />
                                </td>
                            </tr>
                        </table>
                        <div align="right">
                            <h:panelGrid  columns="2">
                                <ace:pushButton id="find" value="#{msg.find}" actionListener="#{auditoriaManagedBean.aplicarFiltro}"/>
                                <ace:pushButton id="actualizar" value="#{msg.actualizar}" actionListener="#{auditoriaManagedBean.actualizar}"/>
                            </h:panelGrid>   
                        </div>
                         <ace:submitMonitor id="submitMonitorPage"
                                           for=":formAuditoria:auditoriaPanelBusqueda"
                                           blockUI="@all"
                                           autoCenter="true"
                                           styleClass="submonitor"
                                           />
                    </ace:panel>
                    <br></br>
                    <div align="right">
                       <div align="right">
                        <ace:pushButton id="exporter" action="successErrorExportAuditoria" actionListener="#{auditoriaManagedBean.prepararReportes()}" > 
                            <i class="fa fa-file-excel-o" aria-hidden="true"></i>
                            #{msg.exportar}
                        </ace:pushButton>
                    </div>
                    </div>
                    <ace:dataTable id="list" value="#{auditoriaManagedBean.listElements}"
                                   page="#{auditoriaManagedBean.page}"
                                   var="item"                                   
                                   lazy="true"
                                   rows="10"
                                   paginator="true"
                                   paginatorAlwaysVisible="true"
                                   paginatorPosition="bottom"
                                   paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                                   currentPageReportTemplate="#{msg.pageReportTemplate}"
                                   rowIndexVar="row">                    
                        <ace:column headerText="#{msg.fechaHora}">
                            <h:outputText value="#{item.fecha}">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" locale="es_AR" timeZone="America/Argentina/Buenos_Aires"/>
                            </h:outputText>
                        </ace:column>
                        <ace:column headerText="#{msg.uss}">                            
                            <h:outputText value="#{item.usuario.apellidoNombre}"/>
                            <br/>
                            <h:outputText value="(#{item.usuario.nombreUsuario})"/> 
                        </ace:column>
                        <ace:column headerText="#{msg.servicio}">
                            <h:outputText value="#{item.usuario.servicio != null ? item.usuario.servicio.codigoAbreviatura : '-'}"/>   
                        </ace:column>
                        <ace:column headerText="#{msg.accion}">
                            <h:outputText value="#{item.accion}"/>   
                        </ace:column>
                         <ace:column headerText="#{msg.valorAnterior}">
                            <h:outputText value="#{item.valorAnterior}" style="white-space: pre-wrap;"/>   
                        </ace:column>
                        <ace:column headerText="#{msg.valorActual}">
                            <h:outputText value="#{item.valorActual}"  style="white-space: pre-wrap;"/>   
                        </ace:column>                     
                    </ace:dataTable>                
                </ace:panel>
                <ace:submitMonitor id="submitMonitorAuditoria"
                                           for="formAuditoria:exporter"
                                           blockUI="@all"
                                           autoCenter="true"
                                           styleClass="submonitor"
                                          
                                           />
            </h:form>
        </ui:define>    
    </ui:composition> 
</html>
