<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:ace="http://www.icefaces.org/icefaces/components"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">      
    <ui:composition template="./layout.xhtml">
        <ui:define name="content">
            <h:form id="formAgregarServicioEjercicio" title=" ">
                <ace:panel id="panelPrincipalAgregarServicioEjercicio" header="#{msg.gestionarServicio}">
                    <br></br>
                    <h:outputLabel value="Ejercicio #{ejercicioManagedBean.ejercicio.anio}" />
                    <h:panelGrid  columns="2" class="panel-buttons">
                        <h:panelGroup>
                            <h:outputLabel value="#{msg.agregarServicio}:" />
                        </h:panelGroup>
                        <h:panelGroup rendered="#{provinciaManagedBean.alta}">
                            <ace:simpleSelectOneMenu 
                                    id="idServicios" label="#{msg.servicios}"
                                    value="#{ejercicioManagedBean.idServicio}"
                                    valueChangeListener="#{ejercicioManagedBean.cargaServicios}"
                                    required="false">
                                    <f:selectItem  itemValue="0" noSelectionOption="false" class="ejercicioAux fuenteMayu" itemLabel="#{msg.seleccionarServicio}"/>
                                    <f:selectItems id="prueba" value="#{ejercicioManagedBean.selectItemsServicios}"/>
                                    <ace:ajax execute="@this" render="@all"/>
                            </ace:simpleSelectOneMenu>
                        </h:panelGroup>
                    </h:panelGrid>
                    <ace:panel id="agregarServicioEjercicioPanelBusqueda" header="#{msg.busqueda}" toggleable="true" closeSpeed="200" collapsed="true" class="panel-buttons">
                        <table border="0" cellspacing="5" class="panel-buttons">
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.codigo}:" />
                                </td>
                                <td align="left">
                                    <ace:textEntry id="codigoBuscar" label="#{msg.nombre}" value="#{ejercicioManagedBean.codigoBsq}"/>
                                </td>                                
                            </tr>
                            <tr>
                                <td align="right">
                                    <h:outputLabel value="#{msg.descripcion}:" />
                                </td>
                                <td align="left">
                                    <ace:textEntry id="descripcionBuscar" label="#{msg.descripcion}" value="#{ejercicioManagedBean.descripcionBsq}"/>                                    
                                </td>                                
                            </tr>
                        </table>       
                        <div align="right" >
                            <h:panelGrid  columns="2">
                                <ace:pushButton id="find" value="#{msg.find}" actionListener="#{ejercicioManagedBean.aplicarFiltroServicios}"/>
                                        <ace:pushButton id="actualizar" value="#{msg.actualizar}" actionListener="#{ejercicioManagedBean.actualizarServicios}"/>
                            </h:panelGrid> 
                        </div>
                    </ace:panel>
                    <ace:dataTable id="serviciosDataTable" 
                                   value="#{ejercicioManagedBean.lstServicioSorted}"
                                   var="item"
                                   paginator="true"
                                   page="#{ejercicioManagedBean.page}"
                                   paginatorPosition="bottom"
                                   paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                                   currentPageReportTemplate="#{msg.pageReportTemplate}"
                                   rows="10"
                                   class="panel-buttons">
                        <ace:column id="columnAbreviatura" headerText="#{msg.codigo}" style="width: 150px !important;">
                            <div class="panel-column-data-center">
                                <h:outputText id="cellAbreviatura" value="#{item.codigo}"/>
                            </div>                            
                        </ace:column>
                        <ace:column id="columnDescripcion" headerText="#{msg.descripcion}">
                            <div class="panel-column-data-left">
                                <h:outputText id="cellDescripcion" value="#{item.descripcion}"/>
                            </div>                            
                        </ace:column>
                        <ace:column id="columnEstado" headerText="#{msg.estado}">
                            <div class="panel-column-data-center">
                                <h:outputText id="cellEstado" value="#{ejercicioManagedBean.exerciseStatus(item.id)}"/>
                            </div>                            
                        </ace:column>
                        <ace:column id="accion" headerText="#{msg.confAction}" class="panelAcciones" style="width:20%">
                            <h:panelGrid  columns="3">
                                <ace:pushButton id="activarEjercicio"
                                                p:title="Activar Ejercicio"
                                                disabled="#{not ejercicioManagedBean.isExcerciseCloseForService(item.id)}"
                                                action="#{ejercicioManagedBean.reOpenExercise()}">
                                    <f:param name="idServicio" value="#{item.id}" />
                                    <span class="fa fa-check" aria-hidden="true" />
                                </ace:pushButton>
                                <ace:pushButton id="cerrarEjercicio"
                                                p:title="Cerrar Ejercicio"
                                                disabled="#{ejercicioManagedBean.isExcerciseCloseForService(item.id)}"
                                                action="#{ejercicioManagedBean.crearCierreEjercicioServicio()}">
                                    <f:param name="idServicio" value="#{item.id}" />
                                    <span class="fa fa-ban" aria-hidden="true" />
                                </ace:pushButton>
                                <ace:pushButton id="eliminar" p:title="#{msg.quitar}" actionListener="#{ejercicioManagedBean.quitarServicio()}">
                                    <span class="fa fa-trash-o" aria-hidden="true" />
                                    <f:param name="id" value="#{item.id}"/>
                                    <ace:ajax execute="@this serviciosDataTable" render="@all" />
                                </ace:pushButton>
                            </h:panelGrid>
                        </ace:column> 
                    </ace:dataTable>
                    <h:inputHidden value="#{ejercicioManagedBean.idEjercicio}"/>                    
                    <table>                  
                        <tr>
                            <td align="right">
                            </td>
                            <td align="left">                    
                                <ace:pushButton id="save" action="#{ejercicioManagedBean.guardarServicios()}" >
                                    <i class="fa fa-floppy-o"></i>
                                    #{msg.save}
                                </ace:pushButton> 
                            </td>
                            <td align="right">
                            </td>
                            <td align="left">                    
                                <ace:pushButton id="cancel"  action="ejercicioConf" >
                                    <i class="fa fa-ban"></i>
                                    #{msg.cancel}
                                </ace:pushButton> 
                            </td>
                        </tr>
                    </table>
                </ace:panel>
            </h:form>
            <ace:submitMonitor id="submitMonitorGestionServicios"
                               for="formAgregarServicioEjercicio:save, formAgregarServicioEjercicio:find, formAgregarServicioEjercicio:actualizar, formAgregarServicioEjercicio:cancel"
                               blockUI="@all"
                               autoCenter="true"
                               activeLabel="#{msg.espere}"
                               networkErrorLabel="#{msg.networkError}"/>
        </ui:define>
    </ui:composition>
</html>